<div>
 <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
  <div xmlns="http://www.w3.org/1999/xhtml">
   <p>Привет, Хабр! Сегодня поговорим про способы упрощения клиентского пути приложений посредством использования подсказок при заполнении данных об адресах и реквизитах организаций, а также рассмотрим опыт подключения сервиса «Подсказок» от DaData к электронной форме документа. И сравним использование «Подсказок» по адресам и адресных справочников Федеральной информационной адресной системы (ФИАС).&nbsp;Через тернии к звездам ведет Алена Сычева, аналитик направления Аналитики «Цифровых технологий», ИТ-”дочки” ДОМ.РФ.&nbsp;&nbsp;</p>
   <h2>Заполнение информации об адресе</h2>
   <p>При заполнении любой электронной формы документа пользователь обязан размещать полную и достоверную информацию, поэтому крайне важно, чтобы сведения, включая информацию об адресе, были указаны точно и в полном объеме. Не секрет, что адрес включает в себя несколько составляющих, заполнять которые в разных полях крайне неудобно пользователю. Регулировать правильность заполнения этих полей также непросто, потому что необходимо подключать проверки к каждому полю со сверкой данных в разных справочниках, которые в свою очередь требуют регулярного обновления. Вероятность допустить ошибку при таком вводе высока. Удобнее, когда адрес можно вводить одной строкой, а если еще и система предложит подходящие варианты, то для пользователя все упрощается в разы. Такое упрощение реализуется при помощи адресных справочников и специальных сервисов.&nbsp;&nbsp;</p>
   <p><strong>Несколько слов о развитии таковых</strong></p>
   <p>До 2018 года развивалась адресная база классификатора адресов РФ&nbsp;в формате КЛАДР. КЛАДР основывается на 6-уровневой структуре адресов: субъект РФ, район, город/населенный пункт, улица, дом, квартира. Справочник не отличается&nbsp;особой точностью адресов. В нем содержатся ошибки, адрес может быть неактуальным, не существовать вообще или дублироваться. Идентификаторы, или&nbsp;коды КЛАДР, могут меняться от версии к версии для одних и тех же объектов, и сама структура адресов часто является трудно разборчивой.&nbsp;</p>
   <p>До середины 2021 года была актуальной и развивалась адресная база Федеральной информационной адресной системы в формате ФИАС. В ФИАС, по сравнению с КЛАДР, была усовершенствована структура хранения информации. В адресном справочнике появились районы/округа в составе субъектов РФ, добавились отметки об актуальности адреса, а также дата начала и окончания действия записи. Более того, ФИАС ввел глобальный идентификатор, GUID, который позволил соединить структуру адреса воедино. До сих пор данный ID является фиксированным и служит ключом для внешних систем по определению элемента адреса.&nbsp;&nbsp;&nbsp;</p>
   <p>Помимо улучшений стоит отметить проблемы, наблюдаемые в адресных справочниках ФИАС:&nbsp;</p>
   <ul>
    <li><p>отображение неактуальной информации (например, устаревшие ОКТМО);&nbsp;</p></li>
    <li><p>отсутствие необходимых в системе данных (например, округа городов федерального назначения);&nbsp;</p></li>
    <li><p>некорректный формат данных (например, «г Город»);&nbsp;</p></li>
    <li><p>неразборчивый формат данных для некоторых адресов.&nbsp;&nbsp;</p></li>
   </ul>
   <p>На смену ФИАС пришла адресная база государственного адресного реестра в формате ГАР. В реестре содержатся сведения об адресах в соответствии с муниципальным и административно-территориальным делениями. Информация об адресе лучше структурирована, модернизирован формат хранения адресов и введен уникальный идентификатор компонентов адреса – OBJECTID, который позволяет оптимизировать поиск данных в справочниках реестра. Плюс для пользователей в том, что поиск адреса осуществляется быстрее.&nbsp;&nbsp;</p>
   <h2>Почему&nbsp;в качестве решения был выбран именно сервис «Подсказок» от DaData&nbsp;&nbsp;</h2>
   <p>«Подсказки» по адресам позволяют пользователю быстро ввести корректный адрес на веб-форме или в приложении. Адресная база сервиса DaData ведется с 2014 года, основной справочник адресов обновляется один раз в неделю. Адреса в справочниках сервиса хранятся во всех форматах: ГАР, ФИАС, и КЛАДР. В целом, использование сервиса DaData значительно повышает качество данных и облегчает процессе заполнения адресов.&nbsp;&nbsp;&nbsp;</p>
   <p>Среди основных плюсов сервиса:&nbsp;</p>
   <ul>
    <li><p>совпадения при вводе адреса пользователем точнее;&nbsp;</p></li>
    <li><p>полнота данных шире;&nbsp;</p></li>
    <li><p>адресный справочник содержит больше адресов;&nbsp;</p></li>
    <li><p>присутствует список исторических названий объекта нижнего уровня, будь то предыдущие наименования города, либо улицы;&nbsp;</p></li>
    <li><p>автоматическое исправление опечаток (стандартизация текста).&nbsp;&nbsp;</p></li>
   </ul>
   <p>Давайте на примере рассмотрим отличие поиска адреса в ФИАС от поиска адреса с использованием «Подсказок» от DaData, чтобы наглядно увидеть различия, плюсы и минусы двух решений. Попробуем ввести адрес: «<em>Московская обл, г. Наро-Фоминский, г Апрелевка</em>», ОКТМО которого с 1 марта 2018 года изменен на <em>46750000006</em>.&nbsp;</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/2ef/93f/b72/2ef93fb72e57560ae5f5d9318ccc8890.png" width="454" height="115" data-src="https://habrastorage.org/getpro/habr/upload_files/2ef/93f/b72/2ef93fb72e57560ae5f5d9318ccc8890.png">
    <figcaption></figcaption>
   </figure>
   <p>Для начала введем адрес с использованием справочника ФИАС. При вводе «Апрелевка» отображается только один вариант адреса, который относится к Калининградской области.&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/2fa/4e8/934/2fa4e8934c73ddbdb13f8ea830820af5.png" width="727" height="439" data-src="https://habrastorage.org/getpro/habr/upload_files/2fa/4e8/934/2fa4e8934c73ddbdb13f8ea830820af5.png">
    <figcaption></figcaption>
   </figure>
   <p>После детализации адреса видим, что данные возвращаются в некорректном формате «г Городское поселение», вместо города значится «р-н».&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d96/0c4/144/d960c414404b0a657847c5914d2635d5.png" width="727" height="439" data-src="https://habrastorage.org/getpro/habr/upload_files/d96/0c4/144/d960c414404b0a657847c5914d2635d5.png">
    <figcaption></figcaption>
   </figure>
   <p>&nbsp;В расширенном ответе по адресу возвращается и устаревший ОКТМО 46638102.&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/2e4/8f9/137/2e48f913747ce8ef3cfead47052bdd96.png" width="1516" height="605" data-src="https://habrastorage.org/getpro/habr/upload_files/2e4/8f9/137/2e48f913747ce8ef3cfead47052bdd96.png">
    <figcaption></figcaption>
   </figure>
   <p>&nbsp;Для сравнения делаем запрос в DaData.&nbsp;&nbsp;</p>
   <p>Результат заметен. DaData возвращает актуальные сведения и предлагает больше схожих вариантов для выбора, что для пользователей является большим преимуществом. ОКТМО возвращается обновленным.&nbsp;&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/b9e/9a5/497/b9e9a5497326fe941b6d3590d9a61e9c.png" width="911" height="244" data-src="https://habrastorage.org/getpro/habr/upload_files/b9e/9a5/497/b9e9a5497326fe941b6d3590d9a61e9c.png">
    <figcaption></figcaption>
   </figure>
   <p>Актуальность возвращаемых данных – основной критерий, по которому был сделан выбор в пользу сервиса DaData.</p>
   <h2>&nbsp;Какие еще есть плюсы у DaData по сравнению с ФИАС</h2>
   <p>Удобно, что поиск в «Подсказках» по адресам гибкий и осуществляется по любой части адреса - от региона до квартиры, причем сервис предлагает большое количество вариантов.</p>
   <p>Вот несколько наглядных примеров:&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/bc8/386/f3a/bc8386f3aa4feacd82a9c1f749c9d26d.png" width="1362" height="643" data-src="https://habrastorage.org/getpro/habr/upload_files/bc8/386/f3a/bc8386f3aa4feacd82a9c1f749c9d26d.png">
    <figcaption></figcaption>
   </figure>
   <p>&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f1a/648/ce1/f1a648ce11a433ba4e92ee476ece0087.png" width="1362" height="643" data-src="https://habrastorage.org/getpro/habr/upload_files/f1a/648/ce1/f1a648ce11a433ba4e92ee476ece0087.png">
    <figcaption></figcaption>
   </figure>
   <p>Еще одним заметным преимуществом является поиск адреса при его вводе в неправильной раскладке. Сервис выдает результаты в соответствии с перекодировкой текста в нужную раскладку. Опечатки при использовании сервиса «Подсказки» автоматически корректируются, поэтому нет необходимости настраивать сложные валидации и придумывать мудреные формы.&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/136/e99/99c/136e9999c009f281f3c35c7ad6f8be2a.png" width="1376" height="617" data-src="https://habrastorage.org/getpro/habr/upload_files/136/e99/99c/136e9999c009f281f3c35c7ad6f8be2a.png">
    <figcaption></figcaption>
   </figure>
   <p>Конечно, справочники DaData не лишены ошибок, для некоторых адресов частично отсутствуют или являются неактуальными данные (ОКТМО, округа городов федерального назначения). Например, для города Видное Московской области отсутствует городской округ Ленинский в ответе, если не подключено автодополнение при вводе. По умолчанию адрес возвращается в административном делении.&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/35b/5ff/f00/35b5fff00d33b38c46d3faf2a0929f59.png" width="1366" height="643" data-src="https://habrastorage.org/getpro/habr/upload_files/35b/5ff/f00/35b5fff00d33b38c46d3faf2a0929f59.png">
    <figcaption></figcaption>
   </figure>
   <p>Есть еще один минус у сервиса «Подсказок» по адресам. Не все поля заполняются однозначно, так корпус, литера, строение, владение передаются в одном параметре data.block, а квартира, комната, помещение, офис передаются в data.flat. Различить их можно только по типу, передаваемому в data.block_type(_full) и data.flat_type(_full) соответственно. Например, если в ответе сервиса пришло значение тип блока «block_type_full» = «Строение», поле формы «Строение» заполняется значением building, поэтому для парсинга адреса на составляющие нужны дополнительные проверки.&nbsp;</p>
   <h2>О «Подсказках» при вводе данных организации&nbsp;</h2>
   <p>Еще один полезный инструмент, который помогает быстро и безошибочно заполнять сведения об организациях в проектной декларации, размещаемых в отношении индивидуальных жилых домов – «Подсказки» по организациям.&nbsp;</p>
   <p>Если требуется указать сведения об организациях, например, об органах, утвердивших документы, об организациях, выдавших заключения экспертизы проектной документации и (или) экспертизы результатов инженерных изысканий, об организациях, выполняющих работы в качестве генеральных подрядчиков и т.д., то заполнение будет производиться на основе «Подсказок» по организациям.&nbsp;&nbsp;</p>
   <p>Пользователь начинает вводить наименование организации или ФИО индивидуального предпринимателя/руководителя организации, ИНН/ОГРН в свободной форме, а сервис автоматически предлагает подходящие варианты и возвращает результаты.&nbsp;&nbsp;</p>
   <p>Поиск организация осуществляется по:&nbsp;</p>
   <ul>
    <li><p>ИНН, ОГРН и КПП;&nbsp;</p></li>
   </ul>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5ba/191/4f5/5ba1914f5e7f7c0f4f09d5dbbff1a57b.png" width="840" height="290" data-src="https://habrastorage.org/getpro/habr/upload_files/5ba/191/4f5/5ba1914f5e7f7c0f4f09d5dbbff1a57b.png">
    <figcaption></figcaption>
   </figure>
   <ul>
    <li><p>названию (полному и краткому);&nbsp;</p></li>
   </ul>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f95/d55/aa9/f95d55aa95c2b82d7dede104847b733c.png" width="840" height="499" data-src="https://habrastorage.org/getpro/habr/upload_files/f95/d55/aa9/f95d55aa95c2b82d7dede104847b733c.png">
    <figcaption></figcaption>
   </figure>
   <ul>
    <li><p>ФИО (для индивидуальных предпринимателей)/ФИО руководителя компании;&nbsp;</p></li>
   </ul>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ef5/59a/9a6/ef559a9a671248965a682045bc8323a0.png" width="848" height="405" data-src="https://habrastorage.org/getpro/habr/upload_files/ef5/59a/9a6/ef559a9a671248965a682045bc8323a0.png">
    <figcaption></figcaption>
   </figure>
   <ul>
    <li><p>адресу до улицы (с ограничениями, у нас поиск по адресу на текущий момент не работает).&nbsp;&nbsp;</p></li>
   </ul>
   <p>Сервис осуществляет поиск только среди действующих или ликвидированных компаний. Важно, что «Подсказки» по организациям основываются на официальной базе налоговой службы. Данные по организациям быстро обновляются и пополняются, максимально возможное отставание от сайта налоговой службы - 3 дня.&nbsp;&nbsp;&nbsp;</p>
   <h2>Как получить сведения из DaData, есть ли отличия от подключения ФИАС&nbsp;</h2>
   <p>Читатели, наверное, уже заметили, что интерфейс для заполнения адреса и информации об организации выглядит просто. На экране сначала отображается единственно поле для ввода данных, которое заполняется с помощью «Подсказок». Активировав флаг уточнения адреса, пользователь может внести недостающие сведения вручную.&nbsp;&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/fab/bb7/071/fabbb707178e4d145cf84d20e32b3fed.png" width="1165" height="393" data-src="https://habrastorage.org/getpro/habr/upload_files/fab/bb7/071/fabbb707178e4d145cf84d20e32b3fed.png">
    <figcaption></figcaption>
   </figure>
   <p>К полю ввода подключается код, который вызывает адресный сервис. Для подключения непосредственно к DaData требуется получить API-ключ, который является паролем от сервиса, и при необходимости оплатить подписку. В нашем случае был получен API-ключ и оформлена лицензия, позволяющая развернуть нужные справочники сервиса в контуре системы. Для DaData есть еще вариант получения данных путем прямого вызова метод API «Подсказок» (для этого необходимо также получить API-ключ), или интеграция с DaData, используя jQuery-плагин.&nbsp;</p>
   <p>Справочники ФИАС/ГАР достаточно загрузить в свою базу данных, а дальше развернуть внутреннее API для работы, подключить плагины.&nbsp;</p>
   <p>Как и ФИАС, так и DaData через API работает по схеме: когда пользователь начинает вводить адрес, система отправляет REST-запрос, на который в режиме реального времени получает ответ от поставщика сведений в формате JSON/XML.&nbsp;&nbsp;</p>
   <p>Запрос к DaData:</p>
   <pre><code>curl --location --request POST 'http://domain/suggestions/api/4_1/rs/suggest/address' \ 

--header 'Accept: application/json' \ 

--header 'Content-Type: application/json' \ 

-- data-raw ' { 

   "query": "115612, г Москва, ул Алма-Атинская" 

 }'  

Запрос к ФИАС: 

curl --location --request POST https:// domain /api/fias/search' \ 

--header 'Accept: application/json' \ 

--header 'Content-Type: application/json' \ 

--data-raw ' { 

   "full_address": "г Москва, ул Алма-Атинская" 

 }'</code></pre>
   <p>После того, как получен подробный ответ, из него забираются нужные данные, которые отображаются в экранной форме. При обычном вводе это адрес одной строкой. Если предусмотрено дробление адреса на части, то в поля экранной формы подставляются гранулярные поля адреса из ответа сервиса.&nbsp;&nbsp;</p>
   <p><strong>Итоги</strong>&nbsp;</p>
   <p>По результатам предварительного подключения «Подсказок» от DaData, анализа и опыта использования сервиса «Подсказок», становится понятно, что наиболее подходящим решением было использование именно его для заполнения полей формы документа. В заключении - краткое сравнение «Подсказок» и ФИАС по основным параметрам.&nbsp;&nbsp;</p>
   <div>
    <div class="table">
     <table>
      <tbody>
       <tr>
        <td><p align="left"><strong>Параметр</strong>&nbsp;</p></td>
        <td><p align="left"><strong>«Подсказки» по адресам</strong>&nbsp;</p></td>
        <td><p align="left"><strong>ФИАС</strong>&nbsp;</p></td>
       </tr>
       <tr>
        <td><p align="left">Поиск&nbsp;</p></td>
        <td><p align="left">Быстрый, гибкий, точный. Встроена стандартизация текста и дешифровка неправильной раскладки клавиатуры&nbsp;</p></td>
        <td><p align="left">Медленный, не достаточно точный. Хорошо отрабатывает только поиск по полному совпадению&nbsp;</p></td>
       </tr>
       <tr>
        <td><p align="left">Ответ на запрос поиска&nbsp;</p></td>
        <td><p align="left">Подробный, в ответе приходят разные подходящие варианты. Муниципальное деление работает при подключении дополнительного модуля&nbsp;</p></td>
        <td><p align="left">Возвращается несколько вариантов. Не всегда нужный адрес возвращается в ответе. Много устаревших данных&nbsp;</p></td>
       </tr>
       <tr>
        <td><p align="left">База данных&nbsp;</p></td>
        <td><p align="left">Адресная база шире, регулярно дополняется новыми адресами и актуализируется&nbsp;</p></td>
        <td><p align="left">Адресный справочник не обновляется&nbsp;</p></td>
       </tr>
       <tr>
        <td><p align="left">Структура данных&nbsp;</p></td>
        <td><p align="left">Структурированные данные. Сервис исключает дублирование данных. Минус, что дома, строения, владения и т.д. передаются в одном параметре&nbsp;</p></td>
        <td><p align="left">По сравнению с КЛАДР информация более структурированная, но для многих адресов целостность структуры нарушена. Встречаются дубли адресов&nbsp;</p></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <p>&nbsp;</p>
   <p></p>
  </div>
 </div>
</div> <!----> <!---->