<div>
 <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
  <div xmlns="http://www.w3.org/1999/xhtml">
   <p>В статье я расскажу, как можно (при необходимости) быстро и дешево собрать кластер Beowulf на основе домашних компьютеров. Выполню я это с помощью компьютеров находящихся в аудитории университета, используя существующую локальную сеть. Используемые программные инструменты: средства численного моделирования механики сплошных сред OpenFOAM, сетевого протокола прикладного уровня SSH и распределенного протокола файловой системы NFS. Все выполнялось под управлением операционной системы ubuntu 20.04.</p>
   <h2>Предисловие</h2>
   <p>Я студент, и мне в прошлом полугодии необходимо было произвести расчет аэродинамики крайне сложного аэродинамического изделия. Мой стационарный компьютер справился с этой задачей весьма долго, в связи с чем потребовалось объединение вычислительных мощностей нескольких компьютеров. Так что в этой статье будет рассмотрены только создание и тестовый запуск расчетов без визуализации массива данных с помощью программы ParaView.</p>
   <p>Тут будет написана инструкция <s>туториал</s> для тех кто хочет повторить. По учебной деятельности я являюсь конструктором, в результате чего при описании команд могут возникать неточности.</p>
   <hr>
   <h2>ВВЕДЕНИЕ</h2>
   <h3>Определение кластера</h3>
   <p><strong> Кластер</strong> – группа компьютеров, объединенных в локальную вычислительную сеть (ЛВС) и способных работать в качестве единого вычислительного ресурса.&nbsp;</p>
   <p>Предполагается, что для кластера обеспечивается более высокая надежность и эффективность, нежели для ЛВС, и существенно более низкая стоимость в сравнении с другими типами параллельных вычислительных систем (за счет использования типовых аппаратных и программных решений).</p>
   <h3>Кластер Beowulf</h3>
   <figure class="float ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/7b1/4ad/7a5/7b14ad7a5e78711eb3d9135d64662441.png" alt="Общеизвестный кластер NASA" title="Общеизвестный кластер NASA" width="500" height="667" data-src="https://habrastorage.org/getpro/habr/upload_files/7b1/4ad/7a5/7b14ad7a5e78711eb3d9135d64662441.png">
    <figcaption>
     Общеизвестный кластер NASA
    </figcaption>
   </figure>
   <p>В настоящее время под кластером типа Beowulf понимается система, которая состоит из одного серверного узла и одного или более клиентских узлов, соединенных при помощи Ethernet или некоторой другой сети. Это система, построенная из готовых серийно выпускающихся промышленных компонентов, на которых может работать ОС Linux, стандартных адаптеров Ethernet и коммутаторов. Она не содержит специфических аппаратных компонентов и легко воспроизводима. Серверный узел управляет всем кластером и является файл-сервером для клиентских узлов. Он также является консолью кластера и шлюзом во внешнюю сеть. Большие системы Beowulf могут иметь более одного серверного узла, а также, возможно, специализированные узлы, например консоли или станции мониторинга. Они конфигурируются и управляются серверными узлами и выполняют только то, что предписано серверным узлом.</p>
   <h3>Вычислительная среда OpenFOAM</h3>
   <p><strong> OpenFOAM</strong> - это бесплатное программное обеспечение CFD с открытым исходным кодом, разработанное, в основном, компанией OpenCFD Ltd с 2004 года. Оно имеет большую базу пользователей в большинстве областей техники и науки, как коммерческих, так и академических организаций. OpenFOAM имеет широкий набор функций для решения любых задач - от сложных потоков жидкости, включающих химические реакции, турбулентность и теплопередачу, до акустики, механики твердого тела и электромагнитных систем.</p>
   <hr>
   <h2>Настройка рабочей среды</h2>
   <h3>Физическое соединение устройств</h3>
   <p>Два и более компьютера нужно соединить друг с другом. Самый простой способ это сделать - задействовать коммутатор и соединить их с помощью витой пары.</p>
   <h3>Выбор операционной системы</h3>
   <p>Решено использовать систему Linux, конкретный дистрибутив - <a href="https://ubuntu.ru/get" rel="noopener noreferrer nofollow"><u>Ubuntu 20.04</u></a>, десктопной и серверной версии соответственно.</p>
   <p>Это связано с тем, что по состоянию на 2022 год среда вычисления OpenFOAM, выбранная для расчётов, стабильно работает именно на этом дистрибутиве именно этой версии. Также система Linux, будучи системой с распространяемыми исходными кодами, является основой для кластера Beowulf.</p>
   <h3>Десктоп-версия</h3>
   <p>Десктоп-версия - это версия системы, имеющая графический интерфейс. Он нужен будет для удобного взаимодействия с файлами, а также для просмотра результатов расчёта. Десктоп-версия будет стоять на главном компьютере.</p>
   <p>После того, как вы с загрузочного диска запустите установщик, следуйте серии шагов:</p>
   <ol>
    <li><p>Выберите язык (предпочтителен <strong>English</strong>);</p></li>
    <li><p>Нажимаем install ubuntu;</p></li>
    <li><p>Выберите язык (предпочтителен <strong>English</strong>);</p></li>
    <li><p><strong>Не </strong>изменяем предустановленные программы;</p></li>
    <li><p><strong>Не </strong>изменяем типы инсталляторов;</p></li>
    <li><p>Выбираем время системы;</p></li>
    <li><p>Введите имя пользователя (в данном случае используется pisi), а также пароль. Пароли и имена серверов должны быть абсолютно одинаковы для всех компьютеров, связанных с кластером.</p></li>
    <li><p>После перезагрузите систему (вам предложит это сделать система)</p></li>
   </ol>
   <h2>Серверная версия</h2>
   <p>Серверная же версия будет стоять на всех остальных компьютерах. На них не потребуется работать с файлами, или просматривать результаты. Все остальные компьютеры нужны исключительно, как дополнительные ресурсы для вычислений, и поэтому для них достаточно самой компактной системы с самым малым набором функций.</p>
   <p>После того, как вы с загрузочного диска запустите установщик, следуйте серии шагов:</p>
   <ol>
    <li><p>Выберите язык (предпочтителен <strong>English</strong>);</p></li>
    <li><p><strong>Не </strong>обновляйте установщик;</p></li>
    <li><p><strong>Не </strong>изменяйте настройки клавиатуры;</p></li>
    <li><p><strong>Не </strong>изменяйте настройки сети;</p></li>
    <li><p>Используйте <strong>весь </strong>диск для установки и подтвердите его перезапись, если потребуется;</p></li>
    <li><p><strong>Не </strong>изменяйте настройки зеркала;</p></li>
    <li><p><strong>Не </strong>изменяйте настройки файловой системы;</p></li>
    <li><p>Введите имя пользователя, сервера, а также пароль. Пароли и имена серверов должны быть абсолютно одинаковы для всех компьютеров, связанных с кластером.</p></li>
    <li><p>Установите OpenSSH-сервер;</p></li>
    <li><p>Server Snaps оставьте <strong>без </strong>изменений;</p></li>
   </ol>
   <p>После окончания установки извлеките загрузочный диск и перезагрузите компьютер.</p>
   <h4>Завершения установки</h4>
   <p>В обоих случаях, вам надо завершить установку, зайдя в директорию Home <strong><em>/home/&lt;user&gt;/</em></strong>, и создать папку OpenFOAM <strong><em>mkdir/OpenFOAM</em></strong>. Должен получиться путь: <strong><em>/home/&lt;user&gt;/OpenFOAM</em></strong>. <strong><em>&lt;user&gt;</em></strong> — это заданное вами имя пользователя (на изображениях в данном документе можно заметить имя «<strong><em>pisi</em></strong>»).</p>
   <p>Наличие подкаталогов в текущем каталоге можно проверить с помощью команды <strong><em>ls</em></strong>.</p>
   <h3>Установка OpenFOAM</h3>
   <p>Установка OpenFOAM состоит так же из двух этапах и должна производиться всех компьютерах участвующих в объединении, это связано с тем, что OpenFOAM это не программа, а набор библиотек необходимых для произведения расчетов системы.</p>
   <p>Для того чтобы установить OpenFOAM необходимо в терминале прописать следующую команду что представлена ниже.</p>
   <pre><code class="bash">curl -s https://dl.openfoam.com/add-debian-repo.sh | sudo bash</code></pre>
   <p>Кратко опишем функционал команды.</p>
   <ol>
    <li><p>curl — команда взаимодействия с интернетом.</p></li>
    <li><p>-s –- сохранение скачанных фалов в систему.</p></li>
    <li><p>url — ссылка на скачиваемый файл.</p></li>
    <li><p>bash — дает возможность создания скриптов.</p></li>
   </ol>
   <p><strong>Примечание</strong>: если по каким то причинам не оказалось команды <strong><em>curl</em></strong>, то введите следующую команду в терминал: <strong><em>sudo apt install curl</em></strong> и убедиться что установлена правильная версия системы.</p>
   <p>Далее необходимо распаковать и скомпилировать выше установленный набор библиотек. Для этого необходимо выполнить команду, приведенную ниже.</p>
   <pre><code class="bash">sudo apt-get install openfoam2006-default</code></pre>
   <p><strong>Примечания: </strong>так как это набор библиотек, то нет практического способа проверить правильность действий, то необходимо проверить их наличие в файловой системе операционной системы.</p>
   <p>Для этого необходимо выполнить следующую команду в терминале.</p>
   <pre><code class="bash">cd /usr/lid/openfoam2006/</code></pre>
   <p>Кратко опишем функционал команды.</p>
   <ol>
    <li><p>cd — это переход в папку по пути.</p></li>
    <li><p>далее идет путь.</p></li>
   </ol>
   <p>Если в результате выполнения команды не появилось ошибок, то все действия выполнены правильно, в противном случае выполните последовательность действий начиная с скачивания OpenFOAM.</p>
   <p>Если проверка прошла успешно, то выполняем команду <strong><em>cd</em></strong><em>.</em></p>
   <h3>Установка и настройка SSH</h3>
   <p><strong><em>SSH</em></strong> — это защищенный протокол для удаленного управления операционной системой. Он пригодится для безопасного соединения компьютеров друг с другом.</p>
   <h3>Десктоп-версия</h3>
   <p>Десктоп-версия по-умолчанию не имеет встроенного SSH, поэтому его нужно установить, это продемонстрировано на примере ниже.</p>
   <pre><code class="bash">sudo apt install openssh-server</code></pre>
   <p>Других отличий нет. Выполняйте все те шаги, что описаны ниже, для серверной версии.</p>
   <h3>Серверная версия</h3>
   <p>В отличие от версии с графическим интерфейсом, серверная версия по-умолчанию имеет в себе предустановленный пакет OpenSSH (точнее, эту опцию можно выбрать при установке), и здесь этап установки не требуется. В противном же случае повторите действия, предназначенные для десктоп-версии.</p>
   <p>Следом выполните следующие шаги.</p>
   <div>
    <div class="table">
     <table>
      <tbody>
       <tr>
        <td><p align="left">Команда</p></td>
        <td><p align="left">Описание</p></td>
       </tr>
       <tr>
        <td><p align="left">mkdir ~/.ssh</p></td>
        <td><p align="left">Создаёт директорию SSH. Может выдать ошибку, если директория уже есть.</p></td>
       </tr>
       <tr>
        <td><p align="left">chmod 700 ~/.ssh</p></td>
        <td><p align="left">Назначает права полного доступа для этой директории. Может потребоваться ввести вместе с sudo.</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh-keygen</p></td>
        <td><p align="left">Создаёт новый ключ. Оставьте все поля по-умолчанию.</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh-copy-id -i /home/&lt;user&gt;/.ssh/id_rsa.pub &lt;user&gt;@&lt;ip&gt;</p></td>
        <td><p>Копирует ваш ключ на другой компьютер по IP-адресу. Это позволит вам позже входить на этот компьютер без пароля.</p><p>&lt;user&gt; — это имя вашего пользователя.</p><p>&lt;ip&gt; — это IP-адрес компьютера, куда вы передаёте ключ.</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh &lt;user&gt;@&lt;ip&gt;</p></td>
        <td><p align="left">Проверка подключения (должна быть без пароля).</p></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <p>Настройте так все компьютеры. Ключи должны быть переданы каждому сателлиту от сервера, и наоборот.</p>
   <p><strong>Примечание</strong>: для проверки работоспособности SSH соединение необходимо проверить несколько условий:</p>
   <ol>
    <li><p>Соединение должно работать от каждого устройства к каждому.</p></li>
    <li><p>Все устройства должны производить соединения без пароля за исключением <strong>первого </strong>раза.</p></li>
    <li><p>Главное, чтобы главный компьютер мог подключиться к серверу и наоборот без пароля.</p></li>
   </ol>
   <hr>
   <h2>Установка и настройка NFS</h2>
   <h3>Установка NFS для Десктоп-версии</h3>
   <p>В командной строке необходимо прописать команду установки утилиты для создания общей сетевой папки среди всех компьютерах кластера.</p>
   <p><strong>Примечание</strong>: предварительно необходимо иметь папку в домашнем каталоге, если этого нет, то просмотрите пункт "Завершения установки".</p>
   <p>Чтобы установить <strong><em>NFS</em></strong>, необходимо скачать его. Для этого пропишем в терминале следующую команду.</p>
   <pre><code class="bash">sudo apt install nfs-kernell-server</code></pre>
   <p>После установки системной утилиты&nbsp; необходимо указать права доступа к папке, которую необходимо синхронизировать. Для этого в терминале нужно прописать следующий набор команд.</p>
   <pre><code class="bash">sudo chown nobody:nogroup /home/{name}/OpenFOAM/</code></pre>
   <p>Кратко опишем функционал команды.</p>
   <ol>
    <li><p><strong><em>chown</em></strong> - это изменение владельца файла или папки</p></li>
    <li><p><strong><em>nobody:nogroup</em></strong> - сообщает системе что папка не принадлежит не одному владельцу и группе</p></li>
   </ol>
   <p>Предоставим права доступа для папки.</p>
   <pre><code class="bash">sudo chown 777 /home/{name}/OpenFOAM/</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p><strong><em>777</em></strong> — это теговое значение прав доступа к последующей папке.</p></li>
   </ol>
   <p>После необходимо внести изменения в файл <strong><em>exports</em></strong>, указав узлы связи, которые вы хотите подключить к ранее приписываемой папке.</p>
   <pre><code class="bash">sudo nano /etc/exports</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p><strong><em>nano</em></strong> — это встроенный редактор текста, основные команды которого являются: Ctrl+S (сохранение файла) и Ctrl+X (выход из редактора).</p></li>
   </ol>
   <p>В самом редакторе необходимо в конце прописать следующую строку.</p>
   <pre><code class="bash">/home/{name}/OpenFOAM {IP-адрес узлов сервера}(rw, sync,no_subtree_check)</code></pre>
   <p>После вписывания в файл следующей команды, повторяем её со всеми компьютерами серверной версии операционной системы.</p>
   <p><strong>Примечание</strong>: для того чтобы узнать IP-адрес компьютера, в командной строке введите команду <strong><em>ip address</em></strong><em>,</em><strong><em> </em></strong>там вы сможете узнать узнать адрес конкретной системы.</p>
   <p>После всех вышеописанных действий необходимо произвести монтирование сервера. Для этого пропишем в терминале команду.</p>
   <pre><code class="bash">sudo exportfs -a</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p>exportfs — это изменяемый файл.</p></li>
    <li><p>-a — то применения изменений к нему.</p></li>
   </ol>
   <p>Следующим шагом необходимо произвести перезагрузку сервера с настроенными параметрами сетевой папки. Для этого пропишем команду в терминале, представленную ниже.</p>
   <pre><code class="bash">sudo systemctl restart nfs-kernel-server.service</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p>systemctl — системный диспетчер.</p></li>
    <li><p>restart — рестарт сервера.</p></li>
    <li><p>nfs-kernel-server.service — файл сервера .</p></li>
   </ol>
   <h3>Настройка утилиты NFS для серверной версии</h3>
   <p>Для этого необходимо произвести закачку программного пакета на устройства. Воспользуемся командной, вводимой в терминале.</p>
   <pre><code class="bash">sudo apt install nfs-common</code></pre>
   <p>После, по аналогии с десктоп-версией, необходимо изменить файлы настройки сетевой папки. Для этого воспользуемся командой.</p>
   <pre><code class="bash">sudo nano /efc/fstab</code></pre>
   <p>После введем в редакторе кода <strong>одну </strong>строчку, относящуюся к десктоп-версии системы.</p>
   <pre><code class="bash">{ip - десктоп версии}:/home/{name}/OpenFOAM nfs defoults 0 1</code></pre>
   <p><strong>Примечание</strong>: Ctrl+S (сохранение файла) и Ctrl+X (выход из редактора).</p>
   <p>Далее смонтируем точку для того, чтобы сообщить десктоп-версии, что сервер готов к общению.</p>
   <pre><code class="bash">sudo mount —all</code></pre>
   <p><strong>Примечание</strong>: Тут могут возникнуть проблемы, это нормально, значит вы что то сделали не так, как было указано в инструкции, это связано с тем что в Ubuntu нет фиксации ошибок. Для этого необходимо произвести ряд проверок, чтобы определить где произошла ошибка.</p>
   <ol>
    <li><p>Проверьте настройку SSH, произведя подключения со всех устройств ко всем командой: ssh {name}@{ip}.</p></li>
    <li><p>Проверьте отсутствие запрашиваемого пароля при SSH-соединение..</p></li>
    <li><p>Проверьте правильность файлов, где прописываются IP-адреса.</p></li>
    <li><p>Проверьте, чтобы не изменились IP-адреса во время настройки (такой случай возможен).</p></li>
    <li><p>Проверьте опечатки местоположения синхронизируемой папки.&nbsp;</p></li>
    <li><p>Проверьте одинаковость названий синхронизируемой папки.&nbsp;</p></li>
    <li><p>Если все вышеперечисленные проверки прошли верно, однако система все равно не заработала, то сделайте все шаги заново, так как старые файлы не удаляются, есть шанс что вы случайно исправите ошибку (на практике это часто срабатывало).</p></li>
   </ol>
   <hr>
   <h2>Начало вычислений</h2>
   <h3>Тест проверки ядер</h3>
   <p>Перед началом работы непосредственно с OpenFOAM стоит разработать программу, которая смогла бы проверить, отзываются ли ядра у всех компьютеров, которые надо будет использовать для последующих вычислений.</p>
   <p>Программа написана на языке С. Исходный код этой программы компилируется в исполняемый файл, именуемый «<strong><em>mpi_hello</em></strong>» (тестовое наименование, наподобие «Hello World!»). Команда компиляции в терминале следующая.</p>
   <pre><code class="bash">mpicc mpi_hello.c -o mpi_hello ./mpi_hello</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p>mpicc — команда запуска компиляции.</p></li>
    <li><p>mpi_hello.c — файл с исходным кодом.</p></li>
    <li><p>-o mpi_hello — выходной файл.</p></li>
   </ol>
   <p>Полный исходный код этой программы приведен в приложении 1, здесь описаны основные моменты её работы.</p>
   <pre><code class="cpp">    int comm_sz;
    MPI_Comm_size(MPI_COMM_WORLD, &amp;comm_sz);

    int rank;
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);

    char hostname[MPI_MAX_PROCESSOR_NAME];
    int name_sz;
    MPI_Get_processor_name(hostname, &amp;name_sz);</code></pre>
   <p>Данный фрагмент кода последовательно получает три параметра: количество ядер, ранг текущего процесса, и имя хоста. Затем эти данные выводятся в терминал.</p>
   <pre><code class="cpp">printf("Hello from %s, rank %d (of %d).\n", hostname, rank, comm_sz);</code></pre>
   <p>Программу можно запустить с помощью команды, представленной ниже.</p>
   <pre><code class="bash">mpirun ./mpi_hello</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p>mpirun — запуск исполняемого файла.</p></li>
    <li><p>./mpi_hello — исполняемый файл.</p></li>
   </ol>
   <p>Результат выводится в консоль.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/712/686/267/7126862673c8cda9417d1438e85aa4b6.png" alt="Результаты работы" title="Результаты работы" width="770" height="490" data-src="https://habrastorage.org/getpro/habr/upload_files/712/686/267/7126862673c8cda9417d1438e85aa4b6.png">
    <figcaption>
     Результаты работы
    </figcaption>
   </figure>
   <h3>Проверка работы программы на нескольких ядрах</h3>
   <p>Следующий этап — указание количества ядер. Для <strong><em>mpirun</em></strong> это возможно сделать с помощью аргумента «<strong><em>np</em></strong>».</p>
   <pre><code class="bash">mpirun -np 2 ./mpi_hello</code></pre>
   <p>Кратко опишем функционал команды:</p>
   <ol>
    <li><p>-np — указания количества ядер.</p></li>
   </ol>
   <p>Результат работы представлен ниже.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/781/c10/9a9/781c109a9194de06e2d37a63e97d8e2d.png" alt="Отчет работы программы по нескольким ядрам" title="Отчет работы программы по нескольким ядрам" width="774" height="491" data-src="https://habrastorage.org/getpro/habr/upload_files/781/c10/9a9/781c109a9194de06e2d37a63e97d8e2d.png">
    <figcaption>
     Отчет работы программы по нескольким ядрам
    </figcaption>
   </figure>
   <h3>Проверка работы на нескольких компьютерах</h3>
   <p>С помощью команды “<strong><em>mpirun</em></strong>” в терминале можно также послать скомпилированную программу на несколько компьютеров.</p>
   <pre><code class="bash">mpirun -np &lt;кол-во процессоров&gt; --hostfile &lt;имя_файла&gt; ./mpi_hello</code></pre>
   <p>Количество процессоров –- общее для всех компьютеров, а имя файла — это имя файла, где перечислены IP-адреса и количество ядер, которое будет у него использоваться.</p>
   <pre><code class="bash">127.0.0.1 slots=4
192.168.0.1 slots=4
192.168.0.105 slots=4</code></pre>
   <ol>
    <li><p>Параметр <strong><em>slots</em></strong> отвечает за количество ядер.</p></li>
    <li><p>Первый адрес, 127.0.0.1, — это локальный адрес компьютера (localhost), с него всегда начинается основная работа. Другие IP-адреса — это IP-адреса других компьютеров.</p></li>
   </ol>
   <p><strong>Примечание</strong>. Данную команду не надо выполнять на компьютере-сателлите, так как локальный адрес будет совпадать с одним из ниже перечисленных, что приведёт к путанице с распределением и последующей ошибке.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/fb0/c16/35d/fb0c1635d8c8dfd20a755ebd09bfeaa4.png" alt="Отчет программы после работы на нескольких компах" title="Отчет программы после работы на нескольких компах" width="790" height="484" data-src="https://habrastorage.org/getpro/habr/upload_files/fb0/c16/35d/fb0c1635d8c8dfd20a755ebd09bfeaa4.png">
    <figcaption>
     Отчет программы после работы на нескольких компах
    </figcaption>
   </figure>
   <p>Проверка концепции ускорения (уменьшение времени) скорости вычислений общей задачи. Для этого воспользуемся стандартной задачей предложенной openfoam на головной странице. Так что первоначально копируем пример из домашней директории OpenFOAM в папку, синхронизируемую ранее (сетевую папку).</p>
   <pre><code class="bash">cp /usr/lid/openfoam2006/tutorials/incompressible/simplefoam/motorBike /home/{name}/OpenFOAM/{name}-v2006/</code></pre>
   <p><strong>Примечание</strong>: предварительно необходимо создать папку {name}-v2006 в папке синхронизируемой системы. Это можно сделать в ручном режиме, если вы создаёте его в десктоп-версии.</p>
   <p>Далее, после того, как в соответствующий каталог скопируются файлы, необходимо будет запустить утилиту создания служебных файлов, находясь в импортированной папке.</p>
   <pre><code class="bash">./Allrun</code></pre>
   <p>После необходимо распаковать файл геометрии мотоцикла, для этого воспользуемся командой, описанной ниже, при использовании встроенного разархиватора.</p>
   <pre><code class="bash">cp $FOAM_TUTORIALS/resources/geometry/motorBike.obj.gz constant/triSurface/</code></pre>
   <p>Далее необходимо создать сетку на компьютере, так как необходимые файлы были экспортированы и распакованы выше. Для того, чтобы выполнить расчет сетки, необходимо прописать в консоли команду.</p>
   <pre><code class="bash">blockMesh</code></pre>
   <p><strong>Примечание</strong>: этот процесс занимает крайне много времени и требует большой объем оперативной памяти. В нашем случае — около 80 ГБ на 3 компьютера. Чтобы не устанавливать дорогостоящую память в компьютер, необходимо увеличить файл <a href="https://andreyex.ru/ubuntu/kak-uvelichit-razmer-swap-v-ubuntu/" rel="noopener noreferrer nofollow">подкачки</a> на SSD-диске.&nbsp;Для этого необходимо выполнить команду.</p>
   <pre><code class="bash">sudo swapoff /swapfile
sudo fallocate -l {Количество дополнительной памяти}G /swapfile</code></pre>
   <p><strong>Примечание</strong>: все промежуточные значения прописываются в файле log ,и если что то пошло не так, то подробности можно узнать там.</p>
   <p>Далее, после просчета сетки, можно приступить к запуску самого расчета задачи. Для этого вставим в командную строку текст.</p>
   <pre><code class="bash">foamJob -p snappyHexMesh</code></pre>
   <hr>
   <h2>ЗАКЛЮЧЕНИЕ</h2>
   <p>В результате проведения стресс тестов кластера на расчет были выявлены закономерности, приведенные в таблицах ниже с выводами. Так же приводятся казусы, которые не решились, или частично были решены в ходе выполнения работы.&nbsp;</p>
   <p><strong>Примечание</strong>: точность выводов основана на субъективной оценке в связи с невозможностью составления прогноза работы и скорости вычислений.&nbsp;</p>
   <p>Мы провели два теста, на машине из 4-х ядер и одном компьютере и машине из 12 ядер и трех компьютеров. Расчет времени выполнения производился автоматически с записью в файл log, это нужно было для отладки работоспособности кластера, но этот процесс занимает определенное время, которое посчитать не удалось. Однако, так как геометрия была одинаковой и файлы log аналогичные, следовательно приобретенное время в двух тестах было одинаковым и в сравнении друг с другом не будут вносить ошибку. Далее приведена таблица с характеристиками двух тестов, которые мы посчитали уместным.</p>
   <div>
    <div class="table">
     <table>
      <tbody>
       <tr>
        <td><p align="left"><strong>Свойство</strong></p></td>
        <td><p align="left"><strong>1 тест</strong></p></td>
        <td><p align="left"><strong>2 тест</strong></p></td>
       </tr>
       <tr>
        <td><p align="left">Количество компьютеров</p></td>
        <td><p align="left">1</p></td>
        <td><p align="left">3</p></td>
       </tr>
       <tr>
        <td><p align="left">Операционные системы</p></td>
        <td><p align="left">Ubuntu desktop</p></td>
        <td><p>Ubuntu desktop</p><p>Ubuntu server</p><p>Ubuntu server</p></td>
       </tr>
       <tr>
        <td><p align="left">Ядра</p></td>
        <td><p align="left">4</p></td>
        <td><p align="left">12</p></td>
       </tr>
       <tr>
        <td><p align="left">Размер сетки</p></td>
        <td><p align="left">800, 200, 200</p></td>
        <td><p align="left">800, 200, 200</p></td>
       </tr>
       <tr>
        <td><p align="left">Время моделирования</p></td>
        <td><p align="left">5000</p></td>
        <td><p align="left">5000</p></td>
       </tr>
       <tr>
        <td><p align="left">Время расчетов</p></td>
        <td><p align="left">119.89 сек</p></td>
        <td><p align="left">13.56 сек</p></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e02/e3e/993/e02e3e993c3359f19933b797c5a90981.png" alt="Обозначения на графиках" title="Обозначения на графиках" width="1285" height="1003" data-src="https://habrastorage.org/getpro/habr/upload_files/e02/e3e/993/e02e3e993c3359f19933b797c5a90981.png">
    <figcaption>
     Обозначения на графиках
    </figcaption>
   </figure>
   <p>Пояснения:</p>
   <ol>
    <li><p>Отсылка данных кластеру</p></li>
    <li><p>Обработка кластером данных</p></li>
    <li><p>Возврат данных головному устройству</p></li>
   </ol>
   <h3>Трудности и особенности работы с кластером:</h3>
   <p>В результате работы кластера были замечены особенности его использования.&nbsp;</p>
   <ol>
    <li><p>Расчет сетки производится силам одного компьютера и составляет существенно больше времени относительно затраченного времени расчетов самой задачи.&nbsp;</p></li>
    <li><p>Размер сетки выбран не случайно и составляет максимум возможности одной машины для составлении сетки. При этом у данной машины основные ограничения связаны с оперативной памятью (нехватка её количества), но сама машина обладала 80 ГБ оперативной памяти.&nbsp;</p></li>
    <li><p>Смотря на график, можно сделать вывод, что время на передачу данных внутри локальной сети, кластер затратил примерно равное с времени самого решения задачи.</p></li>
    <li><p>Если при добавление <strong><em>SWAP</em></strong>&nbsp;оставить мало памяти то после завершения расчетов создастся <strong><em>log</em></strong> файл, который может не поместиться в основную память компьютера и он зависнет намертво. После перезагрузки не будет грузится рабочий стол, однако SSH останется работать. Так что можно принудительно изменить размеры <strong><em>SWAP</em></strong>&nbsp;подключившись к машине через ранее созданный SSH сателлитов.</p></li>
   </ol>
   <hr>
   <h2>Приложение 1. Листинг исходного кода тестовой программы.</h2>
   <pre><code class="bash">#include &lt;mpi.h&gt;
#include &lt;stdio.h&gt;

int main(int argc, char *argv[]) {
    MPI_Init(NULL, NULL);

    int comm_sz;
    MPI_Comm_size(MPI_COMM_WORLD, &amp;comm_sz);

    int rank;
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);

    char hostname[MPI_MAX_PROCESSOR_NAME];
    int name_sz;
    MPI_Get_processor_name(hostname, &amp;name_sz);

    printf("Это %s, ядро %d (of %d).\n", hostname, rank, comm_sz);

    MPI_Finalize();
    return 0;
}</code></pre>
   <h2>Приложение 2. Таблица последовательности введения команд.</h2>
   <div>
    <div class="table">
     <table>
      <tbody>
       <tr>
        <td><p align="left"><strong>Главный</strong></p></td>
        <td><p align="left"><strong>Сателлит</strong></p></td>
       </tr>
       <tr>
        <td><p align="left">sudo apt install neofetch</p></td>
        <td><p align="left">sudo apt install neofetch</p></td>
       </tr>
       <tr>
        <td><p align="left">neofetch</p></td>
        <td><p align="left">neofetch</p></td>
       </tr>
       <tr>
        <td><p align="left">curl -s <a href="https://dl.openfoam.com/add-debian-repo.sh" rel="noopener noreferrer nofollow"><u>https://dl.openfoam.com/add-debian-repo.sh</u></a> | sudo bash</p></td>
        <td><p align="left">curl -s <a href="https://dl.openfoam.com/add-debian-repo.sh" rel="noopener noreferrer nofollow"><u>https://dl.openfoam.com/add-debian-repo.sh</u></a> | sudo bash</p></td>
       </tr>
       <tr>
        <td><p align="left">sudo apt-get install openfoam2006-default</p></td>
        <td><p align="left">sudo apt-get install openfoam2006-default</p></td>
       </tr>
       <tr>
        <td><p align="left">sudo apt install openssh-server</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left">mkdir ~/.ssh</p></td>
        <td><p align="left">mkdir ~/.ssh</p></td>
       </tr>
       <tr>
        <td><p align="left">chmod 700 ~/.ssh</p></td>
        <td><p align="left">chmod 700 ~/.ssh</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh-keygen</p></td>
        <td><p align="left">ssh-keygen</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh-copy-id -i /home/&lt;user&gt;/.ssh/id_rsa.pub &lt;user&gt;@&lt;ip&gt;</p></td>
        <td><p align="left">ssh-copy-id -i /home/&lt;user&gt;/.ssh/id_rsa.pub &lt;user&gt;@&lt;ip&gt;</p></td>
       </tr>
       <tr>
        <td><p align="left">ssh &lt;user&gt;@&lt;ip&gt;</p></td>
        <td><p align="left">ssh &lt;user&gt;@&lt;ip&gt;</p></td>
       </tr>
       <tr>
        <td><p align="left">mkdir OpenFOAM</p></td>
        <td><p align="left">mkdir OpenFOAM</p></td>
       </tr>
       <tr>
        <td><p align="left">sudo apt install nfs-kernell-server</p></td>
        <td><p align="left">sudo apt install nfs-common</p></td>
       </tr>
       <tr>
        <td><p align="left">sudo chown nobody:nogroup /home/{name}/OpenFOAM/</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left">sudo chown 777 /home/{name}/OpenFOAM/</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left">sudo nano /etc/exports</p></td>
        <td><p align="left">sudo nano /efc/fstab</p></td>
       </tr>
       <tr>
        <td><p align="left">/home/{name}/OpenFOAM {IP-адрес узлов сервера}(rw, sync,no_subtree_check)</p></td>
        <td><p align="left">{ip}:/home/pisi/OpenFOAM nfs defoults 0 1</p></td>
       </tr>
       <tr>
        <td><p align="left">sudo exportfs -a</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left">sudo systemctl restart nfs-kernel-server.service</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left">sudo ufw status</p></td>
        <td><p align="left"></p></td>
       </tr>
       <tr>
        <td><p align="left"></p></td>
        <td><p align="left">sudo mount –all</p></td>
       </tr>
      </tbody>
     </table>
    </div>
   </div>
   <p></p>
  </div>
 </div>
</div> <!----> <!---->