<div>
 <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
  <div xmlns="http://www.w3.org/1999/xhtml">
   <p>Наверное вы слышали о новом протоколе BitTorrent v2, работа над которым велась с 2008-го года, и наделала шум с выходом второй версии популярной торрент-библиотеки Libtorrent, которой пользуются знакомые вам торрент-клиенты, такие как QBittorrent, Deluge и многие другие.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/def/33e/c57/def33ec57119262073c5c40fc2bb6b08.jpg" width="1019" height="1024" data-src="https://habrastorage.org/getpro/habr/upload_files/def/33e/c57/def33ec57119262073c5c40fc2bb6b08.jpg" data-blurred="true">
    <figcaption></figcaption>
   </figure>
   <p>Первый полноценный документ для стандартизации <a href="https://www.bittorrent.org/beps/bep_0052.html" rel="noopener noreferrer nofollow">BEP0052</a> (некоторый RFC в мире BitTorrent) вышел в 2017 году, а через три года его наконец-то освоили в некоторых из проектов, почему так долго, спросите вы?</p>
   <p>Дело в том, что протокол BitTorrent поддерживается обществом, и как вы уже догадались имеет открытый исходный код, и как во многих открытых проектах, имеется больше хороших фич, чем людей, которых могли бы их реализовать.</p>
   <p>Релиз BitTorrent v2 по большому обусловил тот факт, что каждая скачанная вами раздача имела уникальный info хеш, и эту раздачу могли поддерживать только те, кто общался по этому хешу. Радикально повлиять на значение этого хеша могло расположение файла, имя и содержание. При переименовании файла в раздаче или перемещении его из одной папки в другую, полностью менялся хеш раздачи и терялась возможность найти предыдущих сидов скачавших раздачу.</p>
   <p><strong>Cross Swarm Seeding</strong></p>
   <p>.torrent файлы созданные с поддержкой BitTorrent v2 имеют в составе корневой Merkle хеш каждого файла раздачи, которые можно анонсировать в децентрализованную сеть DHT. Таким образом, если скажем раздача обновилась (добавили серию вашего любимого сериала), вы можете найти предыдущих пиров и взять с них большинство предыдущих файлов, добавляя себе скорость скачивания, также увеличивается в несколько раз жизнь раздач, решается проблема дубликатов файлов, найти и скачать нужный вам файл становится гораздо проще, даже если раздача древняя и не имеет сидов на данном трекере, а если добавить к этому возможность считывания хешей файлов внутри сжатых архивов, то и ещё больше. Уменьшается нагрузка на конечных пользователей — пользователи не обязаны находить и поддерживать определённые старые раздачи годами, либо их категоризировать, достаточно просто создать торрент с нужными файлами и они станут доступны любому участнику BitTorrent сети по хешу. Увеличивается связность сети — клиент больше находит и связывается с пирами, добавляя их в свою DHT таблицу. Вы даже можете помочь раздачам храня, скажем обычный файл библиотеки msvcp140.dll, которая встречается среди многих програмных сред, фича называется Cross Swarm Seeding.</p>
   <p>В новом протоколе также произошёл переход от уязвимого к коллизиям sha1, теперь хеши генерируются через sha2. Merkle хеш также полезен тем, что если вы скачиваете единственный файл размером в 1 мегабайт, при размере части в 8мб в раздаче, вам не придётся скачивать и хранить остальные 7, чтобы убедиться, что кусок не битый или что пир не шлёт нам ложные данные, скачать придётся только 16кб. Торрент файлы только v2 формата могут весить меньше чем v1, раньше в торрент файле к каждому файлу присоединялось его местоположение, как к примеру folder1/folder2/file, и так для каждого файла, теперь же формат позволяет нам единожды указывать расположение в виде ключа массива со всеми вложенными файлами, как folder1:folder2:file1 file2 file3..fileN</p>
   <p>Но к большому сожалению, с реализацией некоторых из этих функций в клиентах всё ещё есть задержка, больше ухудшает ситуацию нежелание <a href="https://rutracker.net/forum/viewtopic.php?p=84075109#84075109" rel="noopener noreferrer nofollow">администраций</a> трекеров включать его поддержку, скажем показом хешей файлов на страницах раздач. Так появилась бы возможность искать нужные файлы среди разных раздач веб/встроенным поиском, легко извлечь же корневые хеши из торрентов и обычных файлов, можно с помощью таких программ, как <a href="https://github.com/kovalensky/tmrr/" rel="noopener noreferrer nofollow">tmrr</a>.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/897/2dc/d92/8972dcd92e5d232fdb1cafec95c48ca0.png" alt="Примерный вариант показа хешей файлов в раздаче на BitTorrent v2 поддерживаемом трекере." title="Примерный вариант показа хешей файлов в раздаче на BitTorrent v2 поддерживаемом трекере." width="1126" height="58" data-src="https://habrastorage.org/getpro/habr/upload_files/897/2dc/d92/8972dcd92e5d232fdb1cafec95c48ca0.png">
    <figcaption>
     Примерный вариант показа хешей файлов в раздаче на BitTorrent v2 поддерживаемом трекере.
    </figcaption>
   </figure>
   <p>Или показом гибридных магнит ссылок; для сосуществования двух стандартов были созданы гибридные .torrent файлы, которые имеют в составе старый v1 и новый v2 формат, которые поддерживаются всеми старыми торрент клиентами. Только лишь версии Transmission, ниже исправленной четвертой, имеют баг с обработкой таких ссылок и торрентов, и работают некоррентно, но признаться ради, это уже проблема конечных пользователей не желающих обновлять устаревший торрент клиент.</p>
   <p>Пример гибридной магнит ссылки:</p>
   <blockquote>
    <p>magnet:?xt=urn:btih:ХЕШ_v1&amp;xt=urn:<strong>btmh</strong>:<strong>ХЕШ_V2</strong></p>
   </blockquote>
   <p>Ещё одним потенциальным применением на трекерах, могла бы стать кнопка "помочь раздаче". Если трекеру известны популярные файлы в раздаче, которые сидируются, то он может определять малопопулярные файлы, которым можно помочь в сидировании, также показывая здоровье раздачи в процентах. Магнит ссылка генерируется с дополнительным ключом "&amp;so", в котором находятся пронумерированные индексы файлов, а ваш клиент обработав эту ссылку поставит галочки только к определенным файлам до скачивания, полезно для крупных раздач.</p>
   <p>Также некоторых смущает факт существования папки .pad в гибрид раздаче, в новых торрент клиентах она не показывается и не занимает места, в старых её скачивать необязательно, это был необходимый шаг для сосуществования форматов, но это уже скорее забота администраций трекеров, эта папка легко идентифицируется и необходимо её скрыть.</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f29/b44/13f/f29b4413f746ef49dcbe0bcb4d02bed3.png" width="280" height="276" data-src="https://habrastorage.org/getpro/habr/upload_files/f29/b44/13f/f29b4413f746ef49dcbe0bcb4d02bed3.png">
    <figcaption></figcaption>
   </figure>
   <p>В связи с данными проблемами тормозится вхождение и узнаваемость пользователями протокола. Некоторые релизеры не зная, что такое гибрид, и ссылаясь на проблему с Transmission и .pad папку, навсегда забивают на гибрид формат, как на костыль, так и теряется возможность скачать эту же раздачу через Cross Swarm Seeding в будущем, после реализации всех заявленных фич протокола.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/570/009/791/5700097911218e02600e6c228f434d60.png" width="594" height="636" data-src="https://habrastorage.org/getpro/habr/upload_files/570/009/791/5700097911218e02600e6c228f434d60.png">
    <figcaption></figcaption>
   </figure>
   <p>Как и было сказано, пока не найдутся разработчики для <a href="https://github.com/arvidn/libtorrent/" rel="noopener noreferrer nofollow">libtorrent</a>, сам разработчик которого не успевает и на данный момент занят написанием более эффективного алгоритма дискового кеша, BitTorrent v2 несколько лет будет бродить среди туманного сада недореализованных протоколов, за ручку с IPv6.</p>
   <p></p>
  </div>
 </div>
</div> <!----> <!---->