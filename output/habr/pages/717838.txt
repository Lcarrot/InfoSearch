<div>
 <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
  <div xmlns="http://www.w3.org/1999/xhtml">
   <p>Это был типичный подмосковный ЖК, коих сотни. Именно в таком ЖК произошла история, описанная в <a href="https://habr.com/ru/post/713968/" rel="noopener noreferrer nofollow">этой статье</a>. В конце написал что есть еще некоторые идеи и вот руки дошли и до одной из них.</p>
   <p>Все мы знаем что домах 1.5 тыс. домов довольно важно иметь хоть какой-то справочник по квартирам для быстрой связи с собственниками или проживающими. Обычно это exel табличка в виде НОМЕР КВ. - НОМЕР. Но у нас есть бот всеобъемлющий все чаты ЖК, поэтому я решил пойти своим путем.</p>
   <p>Для начала я подумал какие данные можно собрать, а какие наверное не стоит. Учитывая что имена и номера - это конфиденциальные данные человека, которые я не имею права хранить, формат хранения такой:</p>
   <p><strong>дом-секция-этаж-квартира-имя-id-авто</strong></p>
   <p>где:</p>
   <p><em>Имя</em> - ник или при его отсутствии имя в телеграмме. Благо python любезно может реализовывать такие логические выражения очень просто. Также нужно учесть что многие пользователи телеграмма не заполняют поле <em>last_name</em> и просто оставляют его пустым. в таком случае будет передаваться None. Учитывая все вышеперечисленные проблемы я рекомендую использовать вот такой формат:</p>
   <pre><code class="python">call.message.reply_to_message.from_user.username or (str(call.message.reply_to_message.from_user.first_name) + " " + str(call.message.reply_to_message.from_user.last_name or ""))</code></pre>
   <p>Авто - номер автомобиля. Он должен быть на последнем месте потому что его может быть просто не быть. Почему это должно быть так я расскажу позже и постараюсь объяснить почему я реализовал это именно так. Но скорее всего получу гору осуждения по поводу. Проверку правильности ввода номера я делаю при помощи обычной регулярки, которую написал сам, т.к. на просторах интернета мне не очень зашли варианты:</p>
   <pre><code class="python">"^[а-яА-ЯёЁ][0-9]{3}[а-яА-ЯёЁ]{2}[0-9]+$"</code></pre>
   <p>А теперь к решению вопроса о хранении всего этого добра. Я решил не использовать реляционные БД просто потому что она мне в целом не нужна + мне довольно сложно не имея соответствующего опыта разворачивать сервер БД без графического интерфейса. Поэтому я сделал просто txt файл и храню данные именно в таком формате как я указал выше. данные разделяю по порядку через "-". Работает быстро, записывает быстро. Но есть момент. приходится при изменении данных удалять предыдущую строку, двигать весь список вверх на -1 от текущей позиции курсора в файле и записывать снова всё что было ниже + строку, измененную пользователем.</p>
   <pre><code class="python">def edit_user(self, call):
        for i in self.coincidences:
            self.lines.pop(i[1])
        with open("chess_neighbors.txt", "w") as file:
            for text_str in self.lines:
                file.write(text_str)
        self.add_user(call)</code></pre>
   <p>не сложно, но не красиво. Однако работает.</p>
   <p>Формат взаимодействия пользователя с шахматкой такой:</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/912/ef3/2b2/912ef32b2ff85a2a84d949dd122f2de9.png" width="822" height="250" data-src="https://habrastorage.org/getpro/habr/upload_files/912/ef3/2b2/912ef32b2ff85a2a84d949dd122f2de9.png">
    <figcaption></figcaption>
   </figure>
   <p>т.е. просто перечисляем цифрами дом секцию этаж квартиру через пробел с командой /шахматка в ответ на сообщение нужного пользователя, а уже их его сообщения берем id имя usera.</p>
   <p>Интерфейс поиска имеет несколько вариантов:</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/db3/e48/04e/db3e4804e87e3111b2f4141c95bfca1a.png" alt="Поиск по этажу. если бы было указано например /найти 4 8  - мы бы получили всю секцию. Формат вывода неверный, прошу прощения." title="Поиск по этажу. если бы было указано например /найти 4 8  - мы бы получили всю секцию. Формат вывода неверный, прошу прощения." width="817" height="369" data-src="https://habrastorage.org/getpro/habr/upload_files/db3/e48/04e/db3e4804e87e3111b2f4141c95bfca1a.png">
    <figcaption>
     Поиск по этажу. если бы было указано например /найти 4 8 - мы бы получили всю секцию. Формат вывода неверный, прошу прощения.
    </figcaption>
   </figure>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/513/d1f/984/513d1f9845e16ff66067e3d0319bbf22.png" alt="Поиск по контакту. Просто отвечаем командой поиск на сообщение нужного человека. В таком режиме поиска можно удалить найденную квартиру, если человека неверно отметили в шахматке " title="Поиск по контакту. Просто отвечаем командой поиск на сообщение нужного человека. В таком режиме поиска можно удалить найденную квартиру, если человека неверно отметили в шахматке " width="813" height="210" data-src="https://habrastorage.org/getpro/habr/upload_files/513/d1f/984/513d1f9845e16ff66067e3d0319bbf22.png">
    <figcaption>
     Поиск по контакту. Просто отвечаем командой поиск на сообщение нужного человека. В таком режиме поиска можно удалить найденную квартиру, если человека неверно отметили в шахматке
    </figcaption>
   </figure>
   <p>а также по номеру авто соответственно /найти м000мм000 например.</p>
   <p>К сожалению люди неохотно отмечаются в своих квартирах. Но админы потихоньку заполняют данные. И более неохотнее отмечают номер своих авто. Возможно в будущем мы соберем достаточно данных чтоб закрыть чаты домов для неотмеченных пользователей... но это уже совсем другая история.</p>
  </div>
 </div>
</div> <!----> <!---->