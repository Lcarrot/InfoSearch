<div>
 <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
  <div xmlns="http://www.w3.org/1999/xhtml">
   <p>Привет! На связи Роман Люкшин, системный эксперт-аналитик компании «БАРС Груп». По образованию я инженер АСОИУ (Автоматизированные системы обработки информации и управления) и магистр радиофизики.</p>
   <p>Сегодня я продолжу рассказ о том, как создать систему «умный дом» своими руками.&nbsp;</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/af7/3b5/bc1/af73b5bc141153f1ed57b1deafdc0179.png" width="1600" height="900" data-src="https://habrastorage.org/getpro/habr/upload_files/af7/3b5/bc1/af73b5bc141153f1ed57b1deafdc0179.png">
    <figcaption></figcaption>
   </figure>
   <p>В <a href="https://habr.com/ru/company/barsgroup/blog/716648/"><u>первой</u></a> и <a href="https://habr.com/ru/company/barsgroup/blog/717078/"><u>второй</u></a> части статьи можно почитать про необходимое оборудование и настройку различных сценариев работы умного дома с применением голосового помощника Алиса. Ниже расскажу про схемы управления освещением, шторами и теплым полом, а также о неизбежных сложностях при реализации SMART-системы и о том, как их преодолеть.</p>
   <h2>Что надо закупить?</h2>
   <h4>1. Освещение</h4>
   <p>Сначала было закуплено несколько «умных переключателей», которые работали без физических выключателей, т.е. питание подавалось лишь когда устройство включено.</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/c11/632/a97/c11632a97beddfeeb242b05621d2012a.png" width="720" height="540" data-src="https://habrastorage.org/getpro/habr/upload_files/c11/632/a97/c11632a97beddfeeb242b05621d2012a.png">
    <figcaption></figcaption>
   </figure>
   <p>Т.к. данное решение&nbsp;было неудобным и назвать «умным домом» его нельзя,&nbsp;был произведен первый апгрейд оборудования, которое должно&nbsp;было работать постоянно (питание от&nbsp;общей электросети, а&nbsp;не&nbsp;от&nbsp;выключателей).</p>
   <p>Было закуплено оборудование с&nbsp;новой прошивкой и новыми режимами работы:</p>
   <ul>
    <li><p>Умные реле выключатели:</p></li>
   </ul>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/99f/673/f45/99f673f459bc159f907784abd7d69587.png" width="739" height="348" data-src="https://habrastorage.org/getpro/habr/upload_files/99f/673/f45/99f673f459bc159f907784abd7d69587.png">
    <figcaption></figcaption>
   </figure>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/776/00f/27d/77600f27de7fef1e832a236f7be3b5cb.png" width="713" height="499" data-src="https://habrastorage.org/getpro/habr/upload_files/776/00f/27d/77600f27de7fef1e832a236f7be3b5cb.png">
    <figcaption></figcaption>
   </figure>
   <ul>
    <li><p>Умный диммер (регулировка яркости светодиодной подсветки):</p></li>
   </ul>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/9d7/02b/9fd/9d702b9fdf486b3b4b09cebfa93c4b05.png" width="844" height="577" data-src="https://habrastorage.org/getpro/habr/upload_files/9d7/02b/9fd/9d702b9fdf486b3b4b09cebfa93c4b05.png">
    <figcaption></figcaption>
   </figure>
   <p>Управление/инициализация через приложение «Tuya».</p>
   <h4>2. Шторы</h4>
   <p>Были выбраны карнизы от&nbsp;фирмы Onviz c управлением wi‑fi.</p>
   <p>&nbsp;</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/30a/6b9/a94/30a6b9a9433c349be7ef85784f9668a0.png" width="444" height="878" data-src="https://habrastorage.org/getpro/habr/upload_files/30a/6b9/a94/30a6b9a9433c349be7ef85784f9668a0.png">
    <figcaption></figcaption>
   </figure>
   <p>Управление/инициализация через приложение «Mi Home» только через регион «Китай».</p>
   <h4>3. Управление теплым полом</h4>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/630/640/1c0/6306401c0aafa0f4a5352e9dfb9f1acf.png" width="891" height="668" data-src="https://habrastorage.org/getpro/habr/upload_files/630/640/1c0/6306401c0aafa0f4a5352e9dfb9f1acf.png">
    <figcaption></figcaption>
   </figure>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/abc/b4e/ef1/abcb4eef19a9a31bebb503e29341dcee.png" width="887" height="665" data-src="https://habrastorage.org/getpro/habr/upload_files/abc/b4e/ef1/abcb4eef19a9a31bebb503e29341dcee.png">
    <figcaption></figcaption>
   </figure>
   <p>Управление/инициализация через приложение «Tuya».</p>
   <h4>4. Умный удлинитель</h4>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d24/06c/b35/d2406cb35674bfe8a4dc032fec11fbb3.png" width="564" height="752" data-src="https://habrastorage.org/getpro/habr/upload_files/d24/06c/b35/d2406cb35674bfe8a4dc032fec11fbb3.png">
    <figcaption></figcaption>
   </figure>
   <h4>5. Оборудование по протоколу «zigbee»</h4>
   <p>Шлюзы (gateway):</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/948/af1/9a7/948af19a723a4cb2722a889fa2dc6614.png" width="764" height="573" data-src="https://habrastorage.org/getpro/habr/upload_files/948/af1/9a7/948af19a723a4cb2722a889fa2dc6614.png">
    <figcaption></figcaption>
   </figure>
   <p>Датчики влажности и температуры, умная кнопка:</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/996/92b/c9a/99692bc9a57f528c3531930462e30224.png" width="664" height="498" data-src="https://habrastorage.org/getpro/habr/upload_files/996/92b/c9a/99692bc9a57f528c3531930462e30224.png">
    <figcaption></figcaption>
   </figure>
   <h2>Проблематика при выборе оборудования</h2>
   <p>Сейчас опишу обещанные «подводные камни», на&nbsp;которые наткнулся в&nbsp;ходе реализации проекта. Учитесь на&nbsp;моих ошибках и неприятных открытиях.</p>
   <h4>1. Интеграция с Алисой</h4>
   <p>Не&nbsp;все оборудование интегрируется в&nbsp;приложении «Умный дом». Если указано, что&nbsp;есть wi‑fi, то это не&nbsp;означает, что&nbsp;есть и поддержка Алисы. Например, датчик влажности и температуры от «Tuya» не&nbsp;интегрируется с&nbsp;Алисой:</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e8c/abd/8f2/e8cabd8f262969b9a6130be848a1502c.png" width="416" height="443" data-src="https://habrastorage.org/getpro/habr/upload_files/e8c/abd/8f2/e8cabd8f262969b9a6130be848a1502c.png">
    <figcaption></figcaption>
   </figure>
   <h4>2. Поверхностное описание функционала оборудования</h4>
   <p>Такой недостаток чаще всего встречается у&nbsp;приборов, связанных с&nbsp;освещением. При&nbsp;выборе умных мини‑переключателей мне&nbsp;была важна одна из&nbsp;функций, которой нет в&nbsp;описании характеристик&nbsp;— это режим работы переключателя «импульсный выключатель»:</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6d0/b81/6c7/6d0b816c7fc00d4ab9e4981f10b53f32.png" width="505" height="369" data-src="https://habrastorage.org/getpro/habr/upload_files/6d0/b81/6c7/6d0b816c7fc00d4ab9e4981f10b53f32.png">
    <figcaption></figcaption>
   </figure>
   <p>Почему для&nbsp;меня важен этот параметр? Если у&nbsp;физического выключателя больше одной клавиши, то при&nbsp;выключении освещения через приложение или&nbsp;Алису состояние клавиш остается неизменным, т.&nbsp;е. одна клавиша будет в&nbsp;состоянии «включено», а&nbsp;другая «выключено». Становится непонятно, какую клавишу нужно нажать для&nbsp;включения/выключения. Пример на&nbsp;картинке ниже (освещение выключено, но&nbsp;клавиши остались в&nbsp;данном положении):</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8c3/74e/82c/8c374e82c7ff8b84501b6a3faf650530.png" width="681" height="510" data-src="https://habrastorage.org/getpro/habr/upload_files/8c3/74e/82c/8c374e82c7ff8b84501b6a3faf650530.png">
    <figcaption></figcaption>
   </figure>
   <p>Поэтому решил преобразовать физический выключатель в&nbsp;самовозвратный (звонкового типа), чтобы не&nbsp;думать, в&nbsp;какую сторону нажать клавишу. В «импульсном режиме» клавиши всегда в&nbsp;одном положении (например, всегда в&nbsp;состоянии выключено).</p>
   <h4>3. Дизайн</h4>
   <p>Сложно подобрать оборудование по&nbsp;дизайну (даже просто по&nbsp;цвету), в&nbsp;основном все производится белого цвета. Поэтому вместо выключателей, при&nbsp;построении умного дома,&nbsp;были выбраны умные реле.</p>
   <h4>4. Электропроводка с «нулем или без»</h4>
   <p>В&nbsp;основном все оборудование выпускается с&nbsp;электропитанием через «фазу» и «ноль». Но&nbsp;в&nbsp;стандартной проводке у&nbsp;выключателей по&nbsp;классической схеме выводится только «фаза», т.&nbsp;е. нулевой провод в&nbsp;стандартном выключателе отсутствует.</p>
   <p>Если в&nbsp;квартире еще ведется ремонт, то лучше сразу заложить дополнительный «нулевой» провод. Если нет, то проектировать и выбирать оборудование в&nbsp;соответствии с&nbsp;вашей электропроводкой&nbsp;— это или&nbsp;умное реле от&nbsp;распределительной коробки, или&nbsp;выключатели без&nbsp;нулевого провода через байпас (но лучше не&nbsp;использовать).</p>
   <h4>5. Частота обновления данных (датчики)</h4>
   <p>Многие производители не&nbsp;указывают частоту обновления данных с&nbsp;датчиков. Например, в&nbsp;продаже множество датчиков влажности и температуры, которые по&nbsp;описанию должны работать в&nbsp;сценариях умного дома. Но&nbsp;мне подошел только один датчик «Aqara Temperature and Humidity Sensor», который передает данные в&nbsp;режиме реального времени:</p>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/aff/2e5/7d2/aff2e57d2229a9d0e2c49974e61f1559.png" width="550" height="614" data-src="https://habrastorage.org/getpro/habr/upload_files/aff/2e5/7d2/aff2e57d2229a9d0e2c49974e61f1559.png">
    <figcaption></figcaption>
   </figure>
   <p>Остальные датчики передавали информацию раз в 30 минут или раз в час, что очень критично при выполнении сценария.</p>
   <h2>Проблемы и трудности при построении «Умного дома»</h2>
   <h4>1. Негативное влияние устройств друг на друга</h4>
   <p>Для&nbsp;тестирования&nbsp;было установлено около десятка «умных мини реле» для&nbsp;управления освещением. Опытная эксплуатация длилась несколько месяцев и никаких изъянов выявлено не&nbsp;было.</p>
   <p>После, при&nbsp;переходе на «промышленную эксплуатацию» и увеличения на&nbsp;пару устройств случилось непредвиденное, и работы по&nbsp;апгрейду умного дома приостановились почти на&nbsp;два месяца.</p>
   <p>Проблема заключалась в&nbsp;том, что&nbsp;некоторые устройства в&nbsp;рандомный промежуток времени самопроизвольно включали и выключали освещение. Почти два месяца мы выясняли причину такого поведения (проверяли каждое устройство, прозванивали проводку, измеряли напряжение и токи в&nbsp;разные промежутки времени), пришлось даже вскрыть потолки, чтобы добраться до&nbsp;каждого соединения.</p>
   <p>Выяснилось, что&nbsp;причиной такого поведения стало негативное влияние устройств друг на&nbsp;друга, работающих по&nbsp;схеме ниже:</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/c49/c59/c67/c49c59c673c5252439440d36f6f1c4f0.png" width="410" height="360" data-src="https://habrastorage.org/getpro/habr/upload_files/c49/c59/c67/c49c59c673c5252439440d36f6f1c4f0.png">
    <figcaption></figcaption>
   </figure>
   <p>В&nbsp;данной схеме контакты нейтрали «N» (приходящий), «N» (выход на&nbsp;лампу/прибор) и сигнальный контакт «S1» параллельны. В&nbsp;сумме всех подключенных устройств проходил импульс на&nbsp;сигнальный контакт, которого&nbsp;было достаточно для&nbsp;самопроизвольного включения/выключения устройств.</p>
   <p>Не&nbsp;утверждаю, что&nbsp;данная проблема связана со всеми устройствами, работающими по&nbsp;данной схеме.</p>
   <p>Решением стала замена значительного количества устройств на&nbsp;другие, работающие по&nbsp;классической схеме управления по «фазе» (на выключателе):</p>
   <p>&nbsp;</p>
   <figure class="">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ac0/477/32b/ac047732b624345eb9cec808eed7c68a.png" width="426" height="499" data-src="https://habrastorage.org/getpro/habr/upload_files/ac0/477/32b/ac047732b624345eb9cec808eed7c68a.png">
    <figcaption></figcaption>
   </figure>
   <h4>2. Несовместимость оборудования</h4>
   <p>При&nbsp;проектировании схемы подключения необходимо учитывать, каким напряжением от&nbsp;физического выключателя будет управление включения/выключения. Например, если двухклавишный выключатель имеет стандартную электропроводку (приходят три провода: общая фаза и разрыв по&nbsp;фазе на&nbsp;каждую&nbsp;линию/клавишу), то недопустимо, чтобы пересекались переменные (подключение напрямую от&nbsp;электросети) и постоянные токи (подключение через блок питания, например, светодиодная подсветка по&nbsp;питанию 12V).</p>
   <p>Но&nbsp;в данном случае не&nbsp;получилось подключить к&nbsp;физическому двухклавишному выключателю (для управления устройством) одновременно умное реле (220В, переменное напряжение) на&nbsp;одну клавишу и диммер (12В, постоянное напряжение) на&nbsp;другую клавишу.</p>
   <h4>3. Размещение оборудования:</h4>
   <figure class="full-width ">
    <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/449/d16/571/449d165713a0a13baabcf40ee7196f46.png" width="535" height="473" data-src="https://habrastorage.org/getpro/habr/upload_files/449/d16/571/449d165713a0a13baabcf40ee7196f46.png">
    <figcaption></figcaption>
   </figure>
   <p>На&nbsp;картинках и инструкциях указано удобное размещение устройств, но&nbsp;в&nbsp;реальности установить их так практически невозможно.</p>
   <p>Например, умное реле производителем рекомендуется устанавливать в&nbsp;коробку выключателя/розетки. Но&nbsp;в&nbsp;реальности стандартные коробки «классической» электрокоробки, как&nbsp;правило, имеют небольшую глубину. В&nbsp;итоге приходится искать альтернативные способы размещения (например, под&nbsp;натяжным потолком около съемного светильника).</p>
   <h2>Выводы / Рекомендации / Лайфхаки</h2>
   <p>1) Систему «Умный дом» необходимо рассматривать как&nbsp;альтернативный/дополнительный способ управления устройствами, а&nbsp;не&nbsp;основной.</p>
   <p>При&nbsp;проектировании, выборе оборудования, написании сценариев необходимо учитывать негативные ситуации. Как&nbsp;минимум смоделировать сценарии:</p>
   <ul>
    <li><p>отключение интернета,</p></li>
    <li><p>отключение электричества и его включение,</p></li>
    <li><p>недоступно определенное оборудование (например, шлюз для&nbsp;работы устройств по&nbsp;протоколу «zigbee»),</p></li>
    <li><p>вышло из&nbsp;строя устройство «умного дома».</p></li>
   </ul>
   <p>Например, если настроен сценарий отключения вытяжки в&nbsp;ванной по&nbsp;событию изменения влажности с&nbsp;датчика, то при&nbsp;отсутствии данных с&nbsp;датчика необходимо предусмотреть, чтобы вытяжка не&nbsp;работала до&nbsp;бесконечности.</p>
   <p>2) Необходимо сразу составить для&nbsp;себя список задач, которые надо решить. Нет смысла автоматизировать каждую розетку в&nbsp;квартире/доме&nbsp;— это приведет&nbsp;лишь к&nbsp;повышенной нагрузке на&nbsp;сеть и негативному воздействию устройств друг на&nbsp;друга<strong>.</strong></p>
   <p>3) При&nbsp;выборе конечного оборудования (телевизор, кондиционер и&nbsp;т.&nbsp;д.)&nbsp;желательно выбирать модели с&nbsp;поддержкой одного из&nbsp;протоколов обмена (например, «wi‑fi») с&nbsp;возможностью управления через собственное приложение производителя. Даже если на&nbsp;данный момент Алиса не&nbsp;поддерживает интеграцию с&nbsp;данной моделью, то есть вероятность, что&nbsp;в&nbsp;будущем производитель запрограммирует соответствующий навык для&nbsp;Алисы.</p>
   <h4>Примечание</h4>
   <p><em>Еще недавно датчики температуры и влажности не&nbsp;определялись в&nbsp;приложении «Умный дом».</em></p>
   <p>4) Если оборудование работает под&nbsp;управлением приложения, похожего на «Tuya», то с&nbsp;большой вероятностью они добавятся в&nbsp;одно из&nbsp;приложений «Tuya/SmartLife/Digma SmartLife» (например, умный удлинитель от&nbsp;EKF можно добавить напрямую в&nbsp;приложение «Tuya», минуя собственное приложение).</p>
   <p>5) Размещать оборудование необходимо с&nbsp;учетом его дальнейшего обслуживания (например, устройство отвязалось от&nbsp;аккаунта и вам необходимо для&nbsp;повторной привязки зажать на&nbsp;пять секунд кнопку на&nbsp;устройстве), должен&nbsp;быть доступ к&nbsp;устройствам.</p>
   <p>6) Во&nbsp;время работы устройства нагреваются, надо учесть этот фактор и предусмотреть проветривание/вентиляцию, т.&nbsp;е. не&nbsp;стоит их помещать в&nbsp;замкнутом тесном пространстве.</p>
   <p>Вот к&nbsp;таким заключениям я пришел на&nbsp;текущем этапе реализации проекта. Буду рад вопросам и советам от&nbsp;экспертного сообщества!</p>
   <p></p>
  </div>
 </div>
</div> <!----> <!---->